/** @license MIT (http://opensource.org/licenses/MIT) */
if("function"!=typeof define)var define=require("amdefine")(module);define(function(){"use strict";return function(e){return e()}(function(){function e(e){return"boolean"==typeof e}function t(e){return e instanceof Array}function n(e){return"function"==typeof e}function r(e){return n(e)}function i(e){var t,n,r,i=e;if(i)for(t=arguments.length,n=1;t>n;++n)r=arguments[n],i=i.replace(RegExp("\\{"+n+"\\}","g"),r);return i}function a(e,t){return t.type===y.TAIL?!0:void 0===e?t.allowUndefined===!0:null===e?t.allowNull===!0:t.type===y.ANYTYPE?!0:R(e)===t.type||e instanceof t.type}function o(e,n){return n.type===y.TAIL?t(e):void 0===e?n.allowUndefined===!0:null===e?n.allowNull===!0:n.type===y.ANYTYPE?!0:R(e)===n.type||e instanceof n.type}function l(e){return n(e)}function u(e){return t(e)}function f(e){return R(e)===Object}function c(e){e.type===y.TAIL?void 0===e.parenthesizeTail&&(e.parenthesizeTail=v):(void 0===e.allowNull&&(e.allowNull=g),void 0===e.allowUndefined&&(e.allowUndefined=E))}function s(e,t,n){var r={idx:e,name:t,isOptional:!1,type:n};return c(r),r}function p(e,t,n){if(n.length<1)throw Error(i(k,t));var r={idx:e,name:t,isOptional:!0,type:n[0]};if(n.length>=2){if(n.length>2)throw Error(i(_,t));r.hasDefaultValue=!0,r.defaultValue=n[1]}else r.hasDefaultValue=!1;return c(r),r}function h(t,n,r){var a,o={idx:t,name:n};for(a in r)if(r.hasOwnProperty(a))switch(a){case"type":if(u(r.type)){if(r.type.length<1)throw Error(i(k,n));if(r.type.length>2)throw Error(i(_,n));o.isOptional=!0,o.type=r.type[0]}else o.isOptional=!1,o.type=r.type;break;case"defaultValue":o.hasDefaultValue=!0,o.isOptional=!0,o.defaultValue=r[a];break;case"allowUndefined":if(o.allowUndefined=r[a],!e(o.allowUndefined))throw Error(i(V,n,"allowUndefined","boolean"));break;case"allowNull":if(o.allowNull=r[a],!e(o.allowNull))throw Error(i(V,n,"allowNull","boolean"));break;case"parenthesizeTail":if(o.parenthesizeTail=r[a],!e(o.parenthesizeTail))throw Error(i(V,n,"parenthesizeTail","boolean"));break;default:throw Error(i(D,n,a))}return c(o),o}function m(e,t){var n,r,a;for(r in t)if(t.hasOwnProperty(r)){if(void 0!==n)throw Error(i(x,n.name));if(a=t[r],l(a))n=s(e,r,a);else if(u(a))n=p(e,r,a);else{if(!f(a))throw Error(i(Y,r,"type"));n=h(e,r,a)}}return n}function d(e,t){if(!e.name)throw Error(i(P,e.idx));if(!B(e.name))throw Error(i(Y,e.name,"name"));if(!r(e.type))throw Error(i(Y,e.name,"type"));if(e.type!==y.TAIL){if(void 0!==e.parenthesizeTail)throw Error(i(L,e.name,"parenthesizeTail","only"))}else{if(void 0!==e.allowUndefined)throw Error(i(L,e.name,"allowUndefined","not"));if(void 0!==e.allowNull)throw Error(i(L,e.name,"allowNull","not"));if(e.idx!==t-1)throw Error(j)}}function w(e){var t;if(t=n(e.defaultValue)&&e.type!==Function&&e.type!==y.ANYTYPE?e.defaultValue():e.defaultValue,!o(t,e))throw Error(i(U,e.name));return t}function y(){}var g=!1,E=!1,v=!0,b="bad call: ",T=b+'type of "{1}" is invalid.',N=b+"no arguments. function call is not compatible with function specification.",A=b+"too many arguments. function call is not compatible with function specification.",O=b+"parameter specification #{1} is not an object structure.",z='parameter specification "{1}": ',U=z+"default value is not compatible to parameter type",V=z+'value of "{2}" has incorrect type (must be {3})',Y=z+'"{2}" is invalid.',k=z+"type specification is missing.",I=z+"parameter with same name already defined (conflicting position in function specification: #{2})",P="parameter specification: parameter #{1} has no name",x=z+"specification contains more than one element.",L=z+'"{2}" is {3} allowed for the tail-parameter in a variadic function',j="in a variadic function the tail-parameter must be the last parameter in the function specification.",_=z+"type specification has too many elements.",D=z+'type specification contains unknown option "{2}".',S="Incompatible function call: ",$=S+'mandatory argument "{1}" has no value.',q=S+"too many arguments. {1}",F=function(){var e=Object.prototype.toString.call(arguments);return function(t){return Object.prototype.toString.call(t)===e}}(),R=function(e){return void 0===e?void 0:null===e?null:e.constructor},B=function(){var e=/^[_a-z$]{1}[_a-z0-9$]*$/i;return function(t){return t?e.test(t):!1}}();return y.ANYTYPE=function(){},y.TAIL=function(){},y.getArguments=function(e,n){var r,o,l,u,f,c,s,p,h;if(1===arguments.length){if(!F(arguments[0])&&!t(arguments[0]))throw Error(i(T,"_arguments"));if(!arguments[0]||arguments[0].length>0)throw Error(i(q,"no parameters defined but arguments given"));return{}}if(2!==arguments.length)throw Error(arguments.length<1?N:A);if(!t(e))throw Error(i(T,"_functionSpecification"));if(!F(n)&&!t(n))throw Error(i(T,"_arguments"));for(r={},o={},l=e.length,u=n.length,f=0,c=n[f],s=0;l>s;++s){if(p=e[s],R(p)!==Object)throw Error(i(O,s));if(h=m(s,p),d(h,l),o.hasOwnProperty(h.name))throw Error(i(I,h.name,s));if(o[h.name]=h,u>f&&a(c,h)){if(h.type===y.TAIL){r[h.name]=f!==u-1?Array.prototype.slice.call(n,f):!t(c)||h.parenthesizeTail?[c]:c,f=u;break}r[h.name]=c,++f,u>f&&(c=n[f])}else{if(!h.isOptional)throw Error(i($,h.name));h.hasDefaultValue&&(r[h.name]=w(h))}}if(u>f)throw Error(i(q,"there are arguments left but all parameters are processed."));return r},y})});