/** @license MIT (http://opensource.org/licenses/MIT) */
if("function"!=typeof define)var define=require("amdefine")(module);define(function(){"use strict";return function(e){return e()}(function(){function e(e){return e instanceof Array}function n(e){return"function"==typeof e}function t(e){var n,t,r,a=e;if(a)for(n=arguments.length,t=1;n>t;++t)r=arguments[t],a=a.replace(RegExp("\\{"+t+"\\}","g"),r);return a}function r(e,n){return n.type===y.TAIL?!0:void 0===e?n.allowUndefined===!0:null===e?n.allowNull===!0:n.type===y.ANYTYPE?!0:Y(e)===n.type||e instanceof n.type}function a(n,t){return t.type===y.TAIL?e(n):void 0===n?t.allowUndefined===!0:null===n?t.allowNull===!0:t.type===y.ANYTYPE?!0:Y(n)===t.type||n instanceof t.type}function i(e){return n(e)}function o(n){return e(n)}function u(e){return Y(e)===Object}function l(e){e.type===y.TAIL?void 0===e.parenthesizeTail&&(e.parenthesizeTail=g):(void 0===e.allowNull&&(e.allowNull=m),void 0===e.allowUndefined&&(e.allowUndefined=h))}function f(e,n,t){var r={idx:e,name:n,isOptional:!1,type:t};return l(r),r}function c(e,n,t){var r={idx:e,name:n,isOptional:!0,type:t[0]};return t.length>=2?(r.hasDefaultValue=!0,r.defaultValue=t[1]):r.hasDefaultValue=!1,l(r),r}function p(e,n,r){var a,i={idx:e,name:n};for(a in r)if(r.hasOwnProperty(a))switch(a){case"type":o(r.type)?(i.isOptional=!0,i.type=r.type[0]):(i.isOptional=!1,i.type=r.type);break;case"defaultValue":i.hasDefaultValue=!0,i.isOptional=!0,i.defaultValue=r[a];break;case"allowUndefined":i.allowUndefined=r[a];break;case"allowNull":i.allowNull=r[a];break;case"parenthesizeTail":i.parenthesizeTail=r[a];break;default:throw Error(t(E,n,a))}return l(i),i}function s(e,n){var r,a,l;for(a in n)if(n.hasOwnProperty(a)){if(l=n[a],i(l)){r=f(e,a,l);break}if(o(l)){r=c(e,a,l);break}if(u(l)){r=p(e,a,l);break}throw Error(t(A,a,"type"))}return r}function d(e){var r;if(r=n(e.defaultValue)&&e.type!==Function&&e.type!==y.ANYTYPE?e.defaultValue():e.defaultValue,!a(r,e))throw Error(t(T,e.name));return r}function y(){}{var m=!1,h=!1,g=!0,v="bad call: ",w=v+'type of "{1}" is invalid.',b='parameter specification "{1}": ',T=b+"default value is not compatible to parameter type",A=b+'"{2}" is invalid.',E=b+'type specification contains unknown option "{2}".',O="Incompatible function call: ",k=O+'mandatory argument "{1}" has no value.',N=O+"too many arguments. {1}",V=function(){var e=Object.prototype.toString.call(arguments);return function(n){return Object.prototype.toString.call(n)===e}}(),Y=function(e){return void 0===e?void 0:null===e?null:e.constructor};!function(){var e=/^[_a-z$]{1}[_a-z0-9$]*$/i;return function(n){return n?e.test(n):!1}}()}return y.ANYTYPE=function(){},y.TAIL=function(){},y.getArguments=function(n,a){var i,o,u,l,f,c,p,m,h;if(1===arguments.length){if(!V(arguments[0])&&!e(arguments[0]))throw Error(t(w,"_arguments"));if(!arguments[0]||arguments[0].length>0)throw Error(t(N,"no parameters defined but arguments given"));return{}}for(i={},o={},u=n.length,l=a.length,f=0,c=a[f],p=0;u>p;++p)if(m=n[p],h=s(p,m),l>f&&r(c,h)){if(h.type===y.TAIL){i[h.name]=f!==l-1?Array.prototype.slice.call(a,f):!e(c)||h.parenthesizeTail?[c]:c,f=l;break}i[h.name]=c,++f,l>f&&(c=a[f])}else{if(!h.isOptional)throw Error(t(k,h.name));h.hasDefaultValue&&(i[h.name]=d(h))}if(l>f)throw Error(t(N,"there are arguments left but all parameters are processed."));return i},y})});